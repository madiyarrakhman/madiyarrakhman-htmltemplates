{
    "nodes": [
        {
            "parameters": {
                "httpMethod": "POST",
                "path": "whatsapp-incoming",
                "options": {}
            },
            "id": "webhook-trig",
            "name": "WhatsApp Trigger",
            "type": "n8n-nodes-base.webhook",
            "typeVersion": 1,
            "position": [
                0,
                400
            ]
        },
        {
            "parameters": {
                "model": "gpt-4o-mini",
                "options": {
                    "temperature": 0
                }
            },
            "id": "model-node",
            "name": "OpenAI Chat Model",
            "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
            "typeVersion": 1,
            "position": [
                220,
                600
            ],
            "credentials": {
                "openAiApi": {
                    "id": "–í–ê–®_OPENAI_ID"
                }
            }
        },
        {
            "parameters": {
                "promptType": "define",
                "text": "={{ $json.body.entry[0].changes[0].value.messages[0].text.body }}",
                "options": {
                    "systemMessage": "–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —Ç–µ–∫—Å—Ç. –ï—Å–ª–∏ –≤ –Ω–µ–º –µ—Å—Ç—å –∏–º–µ–Ω–∞ –∂–µ–Ω–∏—Ö–∞, –Ω–µ–≤–µ—Å—Ç—ã –∏ –¥–∞—Ç–∞ - –∏–∑–≤–ª–µ–∫–∏ –∏—Ö –≤ JSON. –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç –∏–ª–∏ —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ, –≤–µ—Ä–Ω–∏ JSON: {\"missing\": true}. \n\n–§–æ—Ä–º–∞—Ç –¥–ª—è –¥–∞–Ω–Ω—ã—Ö:\n{\n  \"groomName\": \"...\",\n  \"brideName\": \"...\",\n  \"date\": \"...\",\n  \"location\": \"...\"\n}"
                }
            },
            "id": "ai-extractor",
            "name": "AI Data Extractor",
            "type": "@n8n/n8n-nodes-langchain.agent",
            "typeVersion": 1.1,
            "position": [
                250,
                400
            ]
        },
        {
            "parameters": {
                "conditions": {
                    "boolean": [
                        {
                            "value1": "={{ JSON.parse($json.output).missing }}",
                            "value2": true
                        }
                    ]
                }
            },
            "id": "switch-node",
            "name": "Check Data",
            "type": "n8n-nodes-base.if",
            "typeVersion": 1,
            "position": [
                500,
                400
            ]
        },
        {
            "parameters": {
                "phoneNumberId": "–í–ê–®_PHONE_ID",
                "recipientPhoneNumber": "={{ $node[\"WhatsApp Trigger\"].json.body.entry[0].changes[0].value.messages[0].from }}",
                "messageType": "text",
                "textMessage": "üëã –ü—Ä–∏–≤–µ—Ç! –ß—Ç–æ–±—ã —è —Å–æ–∑–¥–∞–ª —Å–≤–∞–¥–µ–±–Ω–æ–µ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–∏—à–ª–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –≤ —Ç–∞–∫–æ–º —Ñ–æ—Ä–º–∞—Ç–µ:\n\n1. –ò–º—è –∂–µ–Ω–∏—Ö–∞: ...\n2. –ò–º—è –Ω–µ–≤–µ—Å—Ç—ã: ...\n3. –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è: ...\n4. –ú–µ—Å—Ç–æ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è: ...\n\n–ü—Ä–æ—Å—Ç–æ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –º–Ω–µ!",
                "options": {}
            },
            "id": "send-help",
            "name": "Send Format Template",
            "type": "n8n-nodes-base.whatsApp",
            "typeVersion": 1,
            "position": [
                750,
                280
            ],
            "credentials": {
                "whatsAppApi": {
                    "id": "–í–ê–®_WA_CREDENTIALS_ID"
                }
            }
        },
        {
            "parameters": {
                "method": "POST",
                "url": "https://htmltemplates-fi9mn.ondigitalocean.app/api/invitations",
                "sendHeaders": true,
                "headerParameters": {
                    "parameters": [
                        {
                            "name": "x-api-key",
                            "value": "–í–ê–®_PRIVATE_API_KEY"
                        }
                    ]
                },
                "sendBody": true,
                "bodyParameters": {
                    "parameters": [
                        {
                            "name": "phoneNumber",
                            "value": "={{ $node[\"WhatsApp Trigger\"].json.body.entry[0].changes[0].value.messages[0].from }}"
                        },
                        {
                            "name": "content",
                            "value": "={{ JSON.parse($node[\"AI Data Extractor\"].json.output) }}"
                        }
                    ]
                },
                "options": {}
            },
            "id": "api-call",
            "name": "Create Invitation",
            "type": "n8n-nodes-base.httpRequest",
            "typeVersion": 4.1,
            "position": [
                750,
                520
            ]
        },
        {
            "parameters": {
                "phoneNumberId": "–í–ê–®_PHONE_ID",
                "recipientPhoneNumber": "={{ $node[\"WhatsApp Trigger\"].json.body.entry[0].changes[0].value.messages[0].from }}",
                "messageType": "text",
                "textMessage": "üéä –í–∞—à–µ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ! \n\n–°—Å—ã–ª–∫–∞: {{ $json.fullUrl }}\n\n–í—ã –º–æ–∂–µ—Ç–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —ç—Ç—É —Å—Å—ã–ª–∫—É —Å–≤–æ–∏–º –≥–æ—Å—Ç—è–º.",
                "options": {}
            },
            "id": "send-link",
            "name": "Send Link to User",
            "type": "n8n-nodes-base.whatsApp",
            "typeVersion": 1,
            "position": [
                1000,
                520
            ],
            "credentials": {
                "whatsAppApi": {
                    "id": "–í–ê–®_WA_CREDENTIALS_ID"
                }
            }
        }
    ],
    "connections": {
        "WhatsApp Trigger": {
            "main": [
                [
                    {
                        "node": "ai-extractor",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "model-node": {
            "ai_languageModel": [
                [
                    {
                        "node": "ai-extractor",
                        "type": "ai_languageModel",
                        "index": 0
                    }
                ]
            ]
        },
        "ai-extractor": {
            "main": [
                [
                    {
                        "node": "switch-node",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "switch-node": {
            "main": [
                [
                    {
                        "node": "send-help",
                        "type": "main",
                        "index": 0
                    }
                ],
                [
                    {
                        "node": "api-call",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "api-call": {
            "main": [
                [
                    {
                        "node": "send-link",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        }
    }
}